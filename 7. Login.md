# 7. Login
## loginInput

src/user/input/user.logininput.ts
```typescript
@InputType({description: 'Login Input'})
export class LoginInput implements Partial<User> {
  @Field()
  email: string;

  @Field()
  password: string;
}
```

## errorMessage
src/user/shared/errorMessage.ts
```typescript
export const errorMessage = [
    {
      path:'email',
      message:'invalid email or password'
    }
]
```
replace all the relevant code in user.service.ts

## Resolver
user.resolver.ts
```typescript
@Mutation(() => )
  async login(@Args('loginInput') loginInput: LoginInput) {
    return this.userService.login(loginInput)
```

## Service
user.service.ts
```typescript
async login(loginInput:LoginInput){
      const user = await this.userRepo.findOne({where:{email:loginInput.email}})
      if(!user){
        return errorMessage
      }
      const checkPassword = await bcrypt.compare(loginInput.password, user.password)

      if(!checkPassword){
        return errorMessage
      }
    }
```

## express-session
If a user tries to login, we'll add the userId in our cookie, so we can process our users, whenever the user is making a HTTP request, we can extract the userId from request session, that's how we'll be authenticating users on every request

https://www.npmjs.com/package/express-session

Install
```bash
npm install express-session
npm install -D @types/express-session
```

src/constants.ts
```typescript
export const SESSION_SECRET = 'ghasjrfawkflawealjlfs'
```

Add express-session in main.ts
```typescript
async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  app.use(
    session({
      name: 'votingapp',
      secret: SESSION_SECRET,
      cookie: {httpOnly:true, secure: process.env.NODE_ENV === 'production' },
    }),
  );
  await app.listen(3000);
}
```

src/types/myContext.ts
```typescript
import { Request } from "express";

export interface MyContext {
  req: Request
}
```

Add MyContext in resolver and service
```typescript
// user.resolver.ts


```

```typescript
// user.service.ts


```

```typescript

```
```typescript

```
```typescript

```
```typescript

```
```typescript

```
```typescript

```
```typescript

```

